import sys

if len(sys.argv) < 4:
    print 'Usage: python '+sys.argv[0]+' infolder tofolder pmidlist'
    sys.exit(0)

import os
import codecs
from bllipparser import RerankingParser, tokenize

infolder = sys.argv[1]
tofolder = sys.argv[2]
pmids = sys.argv[3].strip().split(',')
pmids = [p.strip() for p in pmids if p.strip() != '']

print 'in folder '+infolder
print 'to folder '+tofolder
print 'process '+str(len(pmids))+' pmids'

print 'loading biomedical model'
#parser = RerankingParser.from_unified_model_dir('/home/leemagpie_gmail_com/local/biomodel/')
parser = RerankingParser.from_unified_model_dir('/home/leebird/local/biomodel/')

for pmid in pmids:
    f = codecs.open(os.path.join(infolder,pmid+'.txt'),'r','utf-8')
    text = f.read().strip()
    f.close()
                    
    #sents = splitter.tokenize(text)
    sents = text.split('\n')
    res = []

    for sent in sents:
        nbest_list = parser.parse(sent.encode('utf-8'))
        if len(nbest_list) == 0:
            #res.append('PARSE_ERROR')
            continue
        else:
            parse_tree = str(nbest_list[0].ptb_parse).decode('utf-8')
            res.append(parse_tree)

    f = codecs.open(os.path.join(tofolder,pmid+'.ptb'),'w','utf-8')
    f.write('\n'.join(res))
    f.close()

#return '\n'.join(res)
